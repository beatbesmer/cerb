{
    "name": "ai.cerb.automationBuilder.action.recordCreate",
    "description": "",
    "extension_id": "cerb.trigger.interaction.internal",
    "script": "start:\r\n  await/type:\r\n    form:\r\n      title: Create a record\r\n      elements:\r\n        sheet/prompt_record_type:\r\n          label: Record Type:\r\n          required@bool: yes\r\n          data:\r\n            automation:\r\n              uri: cerb:automation:cerb.data.record.types\r\n              inputs:\r\n          limit: 100\r\n          schema:\r\n            layout:\r\n              headings@bool: no\r\n              paging@bool: yes\r\n              filtering@bool: yes\r\n              style: grid\r\n            columns:\r\n              selection/uri:\r\n                params:\r\n                  mode: single\r\n                  label_key: label_singular\r\n        submit:\r\n          continue@bool: no\r\n          reset@bool: no\r\n        \r\n  data.query/recordFields:\r\n    inputs:\r\n      query@text:\r\n        type:record.fields\r\n        of:{{prompt_record_type}}\r\n        limit:0\r\n        format:dictionaries\r\n    output: record_fields\r\n  \r\n  await/fields:\r\n    form:\r\n      title: Create {{prompt_record_type}} record\r\n      elements:\r\n        sheet/prompt_record_fields:\r\n          label: Record Fields:\r\n          data@key: record_fields:data\r\n          limit: 50\r\n          default@csv:\r\n            {{\r\n              record_fields.data|filter((field) => field.is_required)|keys|join(',')\r\n            }}\r\n          schema:\r\n            layout:\r\n              headings@bool: no\r\n              paging@bool: yes\r\n              filtering@bool: yes\r\n              style: columns\r\n            columns:\r\n              selection/__index:\r\n                params:\r\n                  mode: multiple\r\n                  label_key: key\r\n                  icon_template@raw: {{is_required ? 'asterisk'}}\r\n              text/type:\r\n                params:\r\n                  value_template@raw: ({{type}})\r\n\r\n  set:\r\n    uniq: {{random_string(6)|lower}}\r\n  \r\n  var.set/command:\r\n    inputs:\r\n      key: command:record.create/{{uniq}}\r\n      value:\r\n        output: new_{{prompt_record_type}}\r\n        inputs:\r\n          record_type: {{prompt_record_type}}\r\n          fields@list:\r\n        on_error@list:\r\n        on_success@list:\r\n  \r\n  repeat/fields:\r\n    each@csv: {{prompt_record_fields|sort|join(',')}}\r\n    as: prompt_record_field\r\n    do:\r\n      set:\r\n        record_field_type@text,trim:\r\n          {{record_fields.data[prompt_record_field].type}}\r\n        record_field_key@text,trim:\r\n          command:record.create/{{uniq}}:inputs:fields:{{prompt_record_field}}\r\n      decision/type:\r\n        outcome/bit:\r\n          if@bool: {{'bit' == record_field_type}}\r\n          then:\r\n            var.set:\r\n              inputs:\r\n                key: {{record_field_key}}\r\n                value@int: 1\r\n        outcome/file:\r\n          if@bool: {{'file' == record_field_type}}\r\n          then:\r\n            var.set:\r\n              inputs:\r\n                key: {{record_field_key}}\r\n                value@int: 123\r\n        outcome/id:\r\n          if@bool: {{'id' == record_field_type}}\r\n          then:\r\n            var.set:\r\n              inputs:\r\n                key: {{record_field_key}}\r\n                value@int: 123\r\n        outcome/image:\r\n          if@bool: {{'image' == record_field_type}}\r\n          then:\r\n            var.set:\r\n              inputs:\r\n                key: {{record_field_key}}@text\r\n                value@text:\r\n                  data:image/png;base64,[...Base64-encoded bytes here...]\r\n        outcome/links:\r\n          if@bool: {{'links' == record_field_type}}\r\n          then:\r\n            var.set:\r\n              inputs:\r\n                key: {{record_field_key}}\r\n                value@list:\r\n                  ticket:123\r\n                  -ticket:456\r\n        outcome/list:\r\n          if@bool: {{'list' == record_field_type}}\r\n          then:\r\n            var.set:\r\n              inputs:\r\n                key: {{record_field_key}}\r\n                value@list:\r\n                  option1\r\n                  option2\r\n        outcome/multicheckbox:\r\n          if@bool: {{'multi-checkbox' == record_field_type}}\r\n          then:\r\n            var.set:\r\n              inputs:\r\n                key: {{record_field_key}}\r\n                value@list:\r\n                  option1\r\n                  option2\r\n        outcome/object:\r\n          if@bool: {{'object' == record_field_type}}\r\n          then:\r\n            var.set:\r\n              inputs:\r\n                key: {{record_field_key}}\r\n                value:\r\n                  key: value\r\n        outcome/timestamp:\r\n          if@bool: {{'timestamp' == record_field_type}}\r\n          then:\r\n            var.set:\r\n              inputs:\r\n                key: {{record_field_key}}@date\r\n                value: now\r\n        outcome/url:\r\n          if@bool: {{'url' == record_field_type}}\r\n          then:\r\n            var.set:\r\n              inputs:\r\n                key: {{record_field_key}}\r\n                value: https://example.com\r\n        outcome/worker:\r\n          if@bool: {{'worker' == record_field_type}}\r\n          then:\r\n            var.set:\r\n              inputs:\r\n                key: {{record_field_key}}\r\n                value@int: 123\r\n        outcome/else:\r\n          then:\r\n            var.set:\r\n              inputs:\r\n                key: {{record_field_key}}\r\n                value@text: value\r\n\r\n  return:\r\n    snippet: {{command|kata_encode}}",
    "policy_kata": "commands:\r\n  data.query:\r\n    deny/type@bool: {{query.type != 'record.fields'}}\r\n    allow@bool: yes",
    "created_at": 1600722810,
    "updated_at": 1639713409
}